<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Weerlive API: Python-script om weersgegevens op te halen en te verwerken - iTheo.Tech</title><meta name="description" content="In dit artikel leer je hoe je een Python-script maakt dat de Weerlive API aanroept om weersinformatie voor een specifieke locatie op te halen. We zullen het script zo ontwerpen dat het JSON-antwoord van de API wordt omgezet in een Python-dictionary. Daarnaast zullen we Poetry&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://itheo.tech/weerlive-api-python-script-om-weersgegevens-op-te-halen-en-te-verwerken.html"><link rel="alternate" type="application/atom+xml" href="https://itheo.tech/feed.xml"><link rel="alternate" type="application/json" href="https://itheo.tech/feed.json"><meta property="og:title" content="Weerlive API: Python-script om weersgegevens op te halen en te verwerken"><meta property="og:image" content="https://itheo.tech/media/posts/98/e1d44dd892a07854a7ebb5e841cbb4b9.jpeg"><meta property="og:image:width" content="1600"><meta property="og:image:height" content="900"><meta property="og:site_name" content="iTheo.Tech"><meta property="og:description" content="In dit artikel leer je hoe je een Python-script maakt dat de Weerlive API aanroept om weersinformatie voor een specifieke locatie op te halen. We zullen het script zo ontwerpen dat het JSON-antwoord van de API wordt omgezet in een Python-dictionary. Daarnaast zullen we Poetry&hellip;"><meta property="og:url" content="https://itheo.tech/weerlive-api-python-script-om-weersgegevens-op-te-halen-en-te-verwerken.html"><meta property="og:type" content="article"><link rel="stylesheet" href="https://itheo.tech/assets/css/style.css?v=6fbb1e8931a5afe843374fd67c192c86"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://itheo.tech/weerlive-api-python-script-om-weersgegevens-op-te-halen-en-te-verwerken.html"},"headline":"Weerlive API: Python-script om weersgegevens op te halen en te verwerken","datePublished":"2023-05-01T11:24","dateModified":"2024-06-01T19:42","image":{"@type":"ImageObject","url":"https://itheo.tech/media/posts/98/e1d44dd892a07854a7ebb5e841cbb4b9.jpeg","height":900,"width":1600},"description":"In dit artikel leer je hoe je een Python-script maakt dat de Weerlive API aanroept om weersinformatie voor een specifieke locatie op te halen. We zullen het script zo ontwerpen dat het JSON-antwoord van de API wordt omgezet in een Python-dictionary. Daarnaast zullen we Poetry&hellip;","author":{"@type":"Person","name":"Theo van der Sluijs","url":"https://itheo.tech/authors/theo-van-der-sluijs/"},"publisher":{"@type":"Organization","name":"Theo van der Sluijs","logo":{"@type":"ImageObject","url":"https://itheo.tech/media/website/itheo.tech-500x125-logo.png","height":125,"width":500}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://itheo.tech/"><img src="https://itheo.tech/media/website/itheo.tech-500x125-logo.png" alt="iTheo.Tech" width="500" height="125"></a><div class="search"><div class="search__overlay js-search-overlay"><div class="search__overlay-inner"><button class="search__close js-search-close" aria-label="Close">Close</button></div></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false"><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://itheo.tech/media/posts/98/e1d44dd892a07854a7ebb5e841cbb4b9.jpeg" srcset="https://itheo.tech/media/posts/98/responsive/e1d44dd892a07854a7ebb5e841cbb4b9-xs.webp 300w, https://itheo.tech/media/posts/98/responsive/e1d44dd892a07854a7ebb5e841cbb4b9-sm.webp 480w, https://itheo.tech/media/posts/98/responsive/e1d44dd892a07854a7ebb5e841cbb4b9-md.webp 768w, https://itheo.tech/media/posts/98/responsive/e1d44dd892a07854a7ebb5e841cbb4b9-lg.webp 1024w, https://itheo.tech/media/posts/98/responsive/e1d44dd892a07854a7ebb5e841cbb4b9-xl.webp 1360w, https://itheo.tech/media/posts/98/responsive/e1d44dd892a07854a7ebb5e841cbb4b9-2xl.webp 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="900" width="1600" alt=""></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2023-05-01T11:24">May 1, 2023</time></div><h1>Weerlive API: Python-script om weersgegevens op te halen en te verwerken</h1><div class="post__meta post__meta--author"><img src="https://itheo.tech/media/website/64.png" loading="eager" height="512" width="512" class="post__author-thumb" alt="Theo van der Sluijs"> <a href="https://itheo.tech/authors/theo-van-der-sluijs/" class="feed__author">Theo van der Sluijs</a></div></div></header></div><div class="wrapper post__entry"><p>In dit artikel leer je hoe je een Python-script maakt dat de Weerlive API aanroept om weersinformatie voor een specifieke locatie op te halen. We zullen het script zo ontwerpen dat het JSON-antwoord van de API wordt omgezet in een Python-dictionary. Daarnaast zullen we Poetry gebruiken voor afhankelijkheidsbeheer en -packaging, en unittests schrijven met de unittest-bibliotheek.</p><h4 id="heading-stap-1-maak-een-nieuw-project-met-poetry">Stap 1: Maak een nieuw project met Poetry</h4><p>Installeer eerst Poetry als je dat nog niet hebt gedaan:</p><pre><code class="lang-bash">curl -sSL https://install.python-poetry.org | python -<restore-line-break></restore-line-break></code></pre><p>Maak een nieuw project met de volgende opdracht:</p><pre><code class="lang-bash">poetry new weerlive-api<restore-line-break></restore-line-break></code></pre><p>Navigeer naar de projectmap:</p><pre><code class="lang-bash"><span class="hljs-built_in">cd</span> weerlive-api<restore-line-break></restore-line-break></code></pre><p>Voeg het <code>requests</code> pakket toe aan het project:</p><pre><code class="lang-bash">poetry add requests<restore-line-break></restore-line-break></code></pre><h4 id="heading-stap-2-schrijf-het-python-script">Stap 2: Schrijf het Python-script</h4><p>Maak een bestand genaamd <a target="_blank" href="http://config.py" rel="noopener"><code>config.py</code></a> en voeg hier je API-key toe:</p><pre><code class="lang-python"><span class="hljs-comment"># config.py</span><restore-line-break>api_key = <span class="hljs-string">"jouw_api_key_hier"</span><restore-line-break></restore-line-break></restore-line-break></code></pre><p>Toegang tot de API loopt via een API key, <a target="_blank" href="https://weerlive.nl/api/toegang/index.php" rel="noopener">deze kun je hier opvragen</a>.</p><p>Maak een nieuw bestand genaamd <code>weerlive_api.py</code> en voeg de volgende code toe:</p><pre><code class="lang-python"><span class="hljs-comment"># weerlive_api.py</span><restore-line-break><span class="hljs-keyword">import</span> requests<restore-line-break><span class="hljs-keyword">import</span> json<restore-line-break><span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> api_key<restore-line-break><restore-line-break><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_weer_data</span>(<span class="hljs-params">locatie</span>):</span><restore-line-break>    url = <span class="hljs-string">f"https://weerlive.nl/api/json-data-10min.php?key=<span class="hljs-subst">{api_key}</span>&locatie=<span class="hljs-subst">{locatie}</span>"</span><restore-line-break>    response = requests.get(url)<restore-line-break><restore-line-break>    <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:<restore-line-break>        data = json.loads(response.text)<restore-line-break>        <span class="hljs-keyword">return</span> data<restore-line-break>    <span class="hljs-keyword">else</span>:<restore-line-break>        print(<span class="hljs-string">f"Fout bij het ophalen van gegevens: <span class="hljs-subst">{response.status_code}</span>"</span>)<restore-line-break>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><restore-line-break><restore-line-break><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:<restore-line-break>    locatie = <span class="hljs-string">"Amsterdam"</span><restore-line-break>    weer_data = get_weer_data(locatie)<restore-line-break><restore-line-break>    <span class="hljs-keyword">if</span> weer_data:<restore-line-break>        print(weer_data)<restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></code></pre><p>Laten we de code in detail bekijken:</p><ul><li><p>We importeren de benodigde modules: <code>requests</code> om de API aan te roepen, <code>json</code> om JSON-gegevens te verwerken en <code>api_key</code> uit het <a target="_blank" href="http://config.py" rel="noopener"><code>config.py</code></a> bestand.</p></li><li><p>De <code>get_weer_data</code> functie neemt één argument, <code>locatie</code>, en roept de Weerlive API aan met de opgegeven API-key en locatie. Het controleert de HTTP-statuscode om te zien of het verzoek succesvol was en converteert het JSON-antwoord naar een Python-dictionary als het verzoek slaagt. Als het verzoek mislukt, wordt er een foutbericht geprint en <code>None</code> geretourneerd.</p></li><li><p>Het <code>if __name__ == "__main__":</code> blok is het startpunt van het script en roept de <code>get_weer_data</code> functie aan met de gewenste locatie (in dit geval "Amsterdam").</p></li></ul><h4 id="heading-stap-3-schrijf-unittests">Stap 3: Schrijf unittests</h4><p>Maak een nieuw bestand genaamd <code>test_weerlive_api.py</code> in de <code>tests</code> map en voeg de volgende code toe:</p><pre><code class="lang-python"><span class="hljs-comment"># tests/test_weerlive_api.py</span><restore-line-break><span class="hljs-keyword">import</span> unittest<restore-line-break><span class="hljs-keyword">from</span> unittest.mock <span class="hljs-keyword">import</span> patch<restore-line-break><span class="hljs-keyword">from</span> weerlive_api <span class="hljs-keyword">import</span> get_weer_data<restore-line-break><restore-line-break><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestWeerliveAPI</span>(<span class="hljs-params">unittest.TestCase</span>):</span><restore-line-break><span class="hljs-meta">    @patch("requests.get")</span><restore-line-break>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_get_weer_data_success</span>(<span class="hljs-params">self, mock_get</span>):</span><restore-line-break>        <span class="hljs-comment"># Mock the API response</span><restore-line-break>        mock_response = mock_get.return_value<restore-line-break>        mock_response.status_code = <span class="hljs-number">200</span><restore-line-break>        mock_response.text = <span class="hljs-string">'{"result": "success"}'</span><restore-line-break><restore-line-break>        locatie = <span class="hljs-string">"Amsterdam"</span><restore-line-break>        result = get_weer_data(locatie)<restore-line-break><restore-line-break>        self.assertEqual(result, {<span class="hljs-string">"result"</span>: <span class="hljs-string">"success"</span>})<restore-line-break><restore-line-break><span class="hljs-meta">    @patch("requests.get")</span><restore-line-break>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_get_weer_data_failure</span>(<span class="hljs-params">self, mock_get</span>):</span><restore-line-break>        <span class="hljs-comment"># Mock the API response</span><restore-line-break>        mock_response = mock_get.return_value<restore-line-break>        mock_response.status_code = <span class="hljs-number">404</span><restore-line-break><restore-line-break>        locatie = <span class="hljs-string">"OnbekendePlaats"</span><restore-line-break>        result = get_weer_data(locatie)<restore-line-break><restore-line-break>        self.assertIsNone(result)<restore-line-break><restore-line-break><span class="hljs-keyword">if</span> name == <span class="hljs-string">"main"</span>:<restore-line-break>    unittest.main()<restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></code></pre><p>In dit bestand hebben we twee unittests gemaakt:</p><p>1. <code>test_get_weer_data_success</code>: Deze test controleert of de <code>get_weer_data</code> functie correct een Python-dictionary retourneert als de API-aanroep succesvol is. We gebruiken <code>patch</code> om de <code>requests.get</code> functie te "mocken" en stellen een gesimuleerde API-respons in.</p><p>2. <code>test_get_weer_data_failure</code>: Deze test controleert of de <code>get_weer_data</code> functie <code>None</code> retourneert als de API-aanroep mislukt. We "mocken" opnieuw de <code>requests.get</code> functie en stellen een gesimuleerde API-respons in met een 404-statuscode. Voer de unittests uit met het volgende commando:</p><pre><code class="lang-bash">poetry run python -m unittest<restore-line-break></restore-line-break></code></pre><h4 id="heading-stap-4-verpak-het-project-met-poetry">Stap 4: Verpak het project met Poetry</h4><p>Verpak het project met Poetry Update het <code>pyproject.toml</code> bestand met de juiste metadata voor het project, zoals de naam, auteur en versie. Je kunt ook de afhankelijkheden en eventuele extra bestanden die moeten worden opgenomen in het pakket specificeren. Bijvoorbeeld:</p><pre><code class="lang-yaml">[<span class="hljs-string">tool.poetry</span>]<restore-line-break><span class="hljs-string">name</span> <span class="hljs-string">=</span> <span class="hljs-string">"weerlive-api"</span><restore-line-break><span class="hljs-string">version</span> <span class="hljs-string">=</span> <span class="hljs-string">"0.1.0"</span><restore-line-break><span class="hljs-string">description</span> <span class="hljs-string">=</span> <span class="hljs-string">"Een eenvoudig Python-script om Weerlive API-data op te halen en te verwerken"</span><restore-line-break><span class="hljs-string">authors</span> <span class="hljs-string">=</span> [<span class="hljs-string">"Jouw Naam <jouw.email @example.com>"</jouw.email></span>]<restore-line-break><span class="hljs-string">license</span> <span class="hljs-string">=</span> <span class="hljs-string">"MIT"</span><restore-line-break><restore-line-break>[<span class="hljs-string">tool.poetry.dependencies</span>]<restore-line-break><span class="hljs-string">python</span> <span class="hljs-string">=</span> <span class="hljs-string">"^3.7"</span><restore-line-break><span class="hljs-string">requests</span> <span class="hljs-string">=</span> <span class="hljs-string">"^2.25"</span><restore-line-break><restore-line-break>[<span class="hljs-string">tool.poetry.dev-dependencies</span>]<restore-line-break><span class="hljs-string">pytest</span> <span class="hljs-string">=</span> <span class="hljs-string">"^6.2"</span><restore-line-break><restore-line-break>[<span class="hljs-string">build-system</span>]<restore-line-break><span class="hljs-string">requires</span> <span class="hljs-string">=</span> [<span class="hljs-string">"poetry-core>=1.0.0"</span>]<restore-line-break><span class="hljs-string">build-backend</span> <span class="hljs-string">=</span> <span class="hljs-string">"poetry.core.masonry.api"</span><restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></code></pre><p>Nu ben je klaar om het project te verpakken en te distribueren met Poetry:</p><pre><code class="lang-bash">poetry build<restore-line-break></restore-line-break></code></pre><p>Dit zal een <code>.tar.gz</code> en een <code>.whl</code> bestand genereren in de <code>dist</code> map.</p><p>Gefeliciteerd! Je hebt nu een Python-script gemaakt om de Weerlive API aan te roepen en de JSON-gegevens te verwerken in een dictionary. Je hebt ook geleerd hoe je Poetry kunt gebruiken voor afhankelijkheidsbeheer en -packaging, en unittests kunt schrijven met de unittest-bibliotheek.</p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on June 1, 2024</p><div class="post__share"></div><div class="post__bio bio"><img src="https://itheo.tech/media/website/64.png" loading="lazy" height="512" width="512" class="bio__avatar" alt="Theo van der Sluijs"><div><h3 class="bio__name"><a href="https://itheo.tech/authors/theo-van-der-sluijs/" rel="author">Theo van der Sluijs</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://itheo.tech/delete-unused-tables-in-wordpress-with-a-plugin.html" class="post__nav-link" rel="prev"><span>Previous</span> Delete unused tables in Wordpress with a plugin</a></div><div class="post__nav-next"><a href="https://itheo.tech/analyzing-web-page-load-times-and-file-sizes-in-python.html" class="post__nav-link" rel="next"><span>Next</span> Analyzing Web Page Load Times and File Sizes in Python </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav></main><footer class="footer"><div class="footer__copyright"><p>iTheo.Tech</p></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script defer="defer" src="https://itheo.tech/assets/js/scripts.min.js?v=f47c11534595205f20935f0db2a62a85"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>