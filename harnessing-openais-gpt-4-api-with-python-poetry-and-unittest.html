<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Harnessing OpenAI&#x27;s GPT-4 API with Python, Poetry and Unittest - iTheo.Tech</title><meta name="description" content="The OpenAI's GPT-4, an advanced language model, offers a powerful tool for natural language processing tasks, including text generation, translation, and more. In this tutorial, I'll explain how to interact with the GPT-4 API using Python, manage dependencies with Poetry, and write tests using the&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://itheo.tech/harnessing-openais-gpt-4-api-with-python-poetry-and-unittest.html"><link rel="alternate" type="application/atom+xml" href="https://itheo.tech/feed.xml"><link rel="alternate" type="application/json" href="https://itheo.tech/feed.json"><meta property="og:title" content="Harnessing OpenAI's GPT-4 API with Python, Poetry and Unittest"><meta property="og:image" content="https://itheo.tech/media/posts/93/463882694423dad66eb24ba433b52197.jpeg"><meta property="og:image:width" content="1600"><meta property="og:image:height" content="1065"><meta property="og:site_name" content="iTheo.Tech"><meta property="og:description" content="The OpenAI's GPT-4, an advanced language model, offers a powerful tool for natural language processing tasks, including text generation, translation, and more. In this tutorial, I'll explain how to interact with the GPT-4 API using Python, manage dependencies with Poetry, and write tests using the&hellip;"><meta property="og:url" content="https://itheo.tech/harnessing-openais-gpt-4-api-with-python-poetry-and-unittest.html"><meta property="og:type" content="article"><link rel="stylesheet" href="https://itheo.tech/assets/css/style.css?v=6fbb1e8931a5afe843374fd67c192c86"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://itheo.tech/harnessing-openais-gpt-4-api-with-python-poetry-and-unittest.html"},"headline":"Harnessing OpenAI's GPT-4 API with Python, Poetry and Unittest","datePublished":"2023-05-17T04:23","dateModified":"2024-06-01T19:42","image":{"@type":"ImageObject","url":"https://itheo.tech/media/posts/93/463882694423dad66eb24ba433b52197.jpeg","height":1065,"width":1600},"description":"The OpenAI's GPT-4, an advanced language model, offers a powerful tool for natural language processing tasks, including text generation, translation, and more. In this tutorial, I'll explain how to interact with the GPT-4 API using Python, manage dependencies with Poetry, and write tests using the&hellip;","author":{"@type":"Person","name":"Theo van der Sluijs","url":"https://itheo.tech/authors/theo-van-der-sluijs/"},"publisher":{"@type":"Organization","name":"Theo van der Sluijs","logo":{"@type":"ImageObject","url":"https://itheo.tech/media/website/itheo.tech-500x125-logo.png","height":125,"width":500}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://itheo.tech/"><img src="https://itheo.tech/media/website/itheo.tech-500x125-logo.png" alt="iTheo.Tech" width="500" height="125"></a><div class="search"><div class="search__overlay js-search-overlay"><div class="search__overlay-inner"><button class="search__close js-search-close" aria-label="Close">Close</button></div></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false"><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://itheo.tech/media/posts/93/463882694423dad66eb24ba433b52197.jpeg" srcset="https://itheo.tech/media/posts/93/responsive/463882694423dad66eb24ba433b52197-xs.webp 300w, https://itheo.tech/media/posts/93/responsive/463882694423dad66eb24ba433b52197-sm.webp 480w, https://itheo.tech/media/posts/93/responsive/463882694423dad66eb24ba433b52197-md.webp 768w, https://itheo.tech/media/posts/93/responsive/463882694423dad66eb24ba433b52197-lg.webp 1024w, https://itheo.tech/media/posts/93/responsive/463882694423dad66eb24ba433b52197-xl.webp 1360w, https://itheo.tech/media/posts/93/responsive/463882694423dad66eb24ba433b52197-2xl.webp 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="1065" width="1600" alt=""></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2023-05-17T04:23">May 17, 2023</time></div><h1>Harnessing OpenAI&#x27;s GPT-4 API with Python, Poetry and Unittest</h1><div class="post__meta post__meta--author"><img src="https://itheo.tech/media/website/64.png" loading="eager" height="512" width="512" class="post__author-thumb" alt="Theo van der Sluijs"> <a href="https://itheo.tech/authors/theo-van-der-sluijs/" class="feed__author">Theo van der Sluijs</a></div></div></header></div><div class="wrapper post__entry"><p>The OpenAI's GPT-4, an advanced language model, offers a powerful tool for natural language processing tasks, including text generation, translation, and more. In this tutorial, I'll explain how to interact with the GPT-4 API using Python, manage dependencies with Poetry, and write tests using the unittest library.</p><h2 id="heading-setup-and-dependencies">Setup and Dependencies</h2><p>To start, I use Poetry, a Python dependency management tool that ensures the project works seamlessly across different environments. It uses a <code>pyproject.toml</code> file to manage dependencies.</p><p>Here's a sample <code>pyproject.toml</code>:</p><pre><code class="lang-toml"><span class="hljs-section">[tool.poetry]</span><restore-line-break><span class="hljs-attr">name</span> = <span class="hljs-string">"chatgpt-api"</span><restore-line-break><span class="hljs-attr">version</span> = <span class="hljs-string">"0.1.0"</span><restore-line-break><span class="hljs-attr">description</span> = <span class="hljs-string">"Python script to interact with the ChatGPT API"</span><restore-line-break><span class="hljs-attr">authors</span> = [<span class="hljs-string">"Your Name <your.email @example.com>"</your.email></span>]<restore-line-break><restore-line-break><span class="hljs-section">[tool.poetry.dependencies]</span><restore-line-break><span class="hljs-attr">python</span> = <span class="hljs-string">"^3.9"</span><restore-line-break><span class="hljs-attr">openai</span> = <span class="hljs-string">"^0.27.0"</span><restore-line-break><span class="hljs-attr">toml</span> = <span class="hljs-string">"^0.10.2"</span><restore-line-break><restore-line-break><span class="hljs-section">[tool.poetry.dev-dependencies]</span><restore-line-break><span class="hljs-attr">pytest</span> = <span class="hljs-string">"^6.2.5"</span><restore-line-break><restore-line-break><span class="hljs-section">[build-system]</span><restore-line-break><span class="hljs-attr">requires</span> = [<span class="hljs-string">"poetry-core>=1.0.0"</span>]<restore-line-break><span class="hljs-attr">build-backend</span> = <span class="hljs-string">"poetry.core.masonry.api"</span><restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></code></pre><p>This file includes the project metadata and dependencies. Among the dependencies are Python 3.9, OpenAI's Python client library, and the toml library for parsing and creating TOML files.</p><h2 id="heading-interacting-with-the-openai-api">Interacting with the OpenAI API</h2><p>The Python script <a target="_blank" href="http://main.py" rel="noopener"><code>main.py</code></a> uses the OpenAI Python library to interact with the GPT-4 API. I use the <code>config.toml</code> file to store the OpenAI API key securely.</p><p>The <a target="_blank" href="http://main.py" rel="noopener"><code>main.py</code></a> script is structured into three main functions:</p><p><code>load_config()</code></p><p>This function loads the <code>config.toml</code> file and returns the OpenAI API key.</p><pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_config</span>():</span><restore-line-break>    <span class="hljs-comment"># Load the configuration file</span><restore-line-break>    config = toml.load(<span class="hljs-string">"config.toml"</span>)<restore-line-break>    <span class="hljs-keyword">return</span> config[<span class="hljs-string">"openai"</span>][<span class="hljs-string">"api_key"</span>]<restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></code></pre><p><code>call_chat_api(prompt)</code></p><p>This function accepts a prompt, sends it to the GPT-4 API, and returns the generated text. It first loads the API key with the <code>load_config</code> function, then uses the <code>openai.Completion.create</code> method to call the API.</p><pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">call_chat_api</span>(<span class="hljs-params">prompt</span>):</span><restore-line-break>    api_key = load_config()<restore-line-break>    openai.api_key = api_key<restore-line-break><restore-line-break>    response = openai.Completion.create(<restore-line-break>        model=<span class="hljs-string">"text-davinci-003"</span>,<restore-line-break>        prompt=prompt,<restore-line-break>        max_tokens=<span class="hljs-number">60</span><restore-line-break>    )<restore-line-break>    <span class="hljs-keyword">return</span> response.choices[<span class="hljs-number">0</span>].text.strip()<restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></code></pre><p><code>main()</code></p><p>This is the main function that gets user input, calls the <code>call_chat_api</code> function with the input, and prints the generated response.</p><pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><restore-line-break>    prompt = input(<span class="hljs-string">"Enter your question: "</span>)<restore-line-break>    response = call_chat_api(prompt)<restore-line-break>    print(<span class="hljs-string">f"ChatGPT response: <span class="hljs-subst">{response}</span>"</span>)<restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></code></pre><h2 id="heading-testing-with-unittest">Testing with Unittest</h2><p>To ensure the code works correctly, I'll use Python's unittest framework to write tests. Here's a basic test for the <code>load_config</code> function:</p><pre><code class="lang-python"><span class="hljs-keyword">import</span> unittest<restore-line-break><span class="hljs-keyword">from</span> unittest.mock <span class="hljs-keyword">import</span> patch<restore-line-break><span class="hljs-keyword">from</span> main <span class="hljs-keyword">import</span> load_config<restore-line-break><restore-line-break><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestLoadConfig</span>(<span class="hljs-params">unittest.TestCase</span>):</span><restore-line-break><span class="hljs-meta">    @patch('toml.load')</span><restore-line-break>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_load_config</span>(<span class="hljs-params">self, mock_load</span>):</span><restore-line-break>        mock_load.<span class="hljs-keyword">return</span><restore-line-break>        mock_load.return_value = {<span class="hljs-string">"openai"</span>: {<span class="hljs-string">"api_key"</span>: <span class="hljs-string">"test_key"</span>}}<restore-line-break>        result = load_config()<restore-line-break>        self.assertEqual(result, <span class="hljs-string">"test_key"</span>)<restore-line-break><restore-line-break><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<restore-line-break>    unittest.main()<restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></code></pre><p>The <code>TestLoadConfig</code> class inherits from <code>unittest.TestCase</code>. It has a single test method, <code>test_load_config</code>, which tests the <code>load_config</code> function from the <a target="_blank" href="http://main.py" rel="noopener"><code>main.py</code></a> script. The <code>@patch</code> decorator is used to mock the <code>toml.load</code> function, so it returns a predefined result instead of reading an actual file. This allows us to test <code>load_config</code> in isolation.</p><h2 id="heading-conclusion">Conclusion</h2><p>In this tutorial, I've walked through creating a Python script that uses the OpenAI's GPT-4 API for text generation. I have used Poetry for managing dependencies and unittest for writing tests to ensure the functionality of the code. With the understanding of these concepts, you can now integrate OpenAI's powerful language model into your Python applications.</p><p>Remember to always securely handle your API keys, especially when your code is hosted publicly. Never hard-code your API keys directly into your scripts, always use a secure method such as environment variables or configuration files that aren't included in your version control system.</p><p>I hope this guide serves as a helpful starting point for your journey with OpenAI's GPT-4 and Python. Happy coding!</p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on June 1, 2024</p><div class="post__share"></div><div class="post__bio bio"><img src="https://itheo.tech/media/website/64.png" loading="lazy" height="512" width="512" class="bio__avatar" alt="Theo van der Sluijs"><div><h3 class="bio__name"><a href="https://itheo.tech/authors/theo-van-der-sluijs/" rel="author">Theo van der Sluijs</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://itheo.tech/building-a-url-monitor-in-python.html" class="post__nav-link" rel="prev"><span>Previous</span> Building a URL Monitor in Python</a></div><div class="post__nav-next"><a href="https://itheo.tech/adding-a-featured-image-filter-in-woocommerce-admin-product-screen.html" class="post__nav-link" rel="next"><span>Next</span> Adding a Featured Image Filter in WooCommerce Admin Product Screen </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav><div class="post__related related"><div class="wrapper"><h2 class="h5 related__title">You should also read:</h2><article class="related__item"><div class="feed__meta"><time datetime="2015-02-05T19:42" class="feed__date">February 5, 2015</time></div><h3 class="h1"><a href="https://itheo.tech/url-shortener-with-php-and-mongodb-script.html">Url shortener with PHP and MongoDB script</a></h3></article><article class="related__item"><div class="feed__meta"><time datetime="2015-08-11T11:52" class="feed__date">August 11, 2015</time></div><h3 class="h1"><a href="https://itheo.tech/better-mongodb-backup-script-with-tar-and-move-to-s3-bucket.html">Better MongoDB backup script with Tar and move to S3 Bucket</a></h3></article><article class="related__item"><div class="feed__meta"><time datetime="2018-03-18T12:35" class="feed__date">March 18, 2018</time></div><h3 class="h1"><a href="https://itheo.tech/using-ubuntu-on-windows-10-without-admin-rights.html">Using Ubuntu on Windows 10 without Admin Rights</a></h3></article></div></div></main><footer class="footer"><div class="footer__copyright"><p>iTheo.Tech</p></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script defer="defer" src="https://itheo.tech/assets/js/scripts.min.js?v=f47c11534595205f20935f0db2a62a85"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>