<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Unlocking Pages with Custom User Roles in WordPress - iTheo.Tech</title><meta name="description" content="Hello, fellow WordPress enthusiasts! Have you ever wondered how you can take full control over who gets to see what on your WordPress site? Today, I'm going to share the story of how I created a custom WordPress plugin that allows you to do just&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://itheo.tech/unlocking-pages-with-custom-user-roles-in-wordpress.html"><link rel="alternate" type="application/atom+xml" href="https://itheo.tech/feed.xml"><link rel="alternate" type="application/json" href="https://itheo.tech/feed.json"><meta property="og:title" content="Unlocking Pages with Custom User Roles in WordPress"><meta property="og:image" content="https://itheo.tech/media/posts/103/620d6c13-b129-4771-ae4b-13b646c82058.png"><meta property="og:image:width" content="1792"><meta property="og:image:height" content="1024"><meta property="og:site_name" content="iTheo.Tech"><meta property="og:description" content="Hello, fellow WordPress enthusiasts! Have you ever wondered how you can take full control over who gets to see what on your WordPress site? Today, I'm going to share the story of how I created a custom WordPress plugin that allows you to do just&hellip;"><meta property="og:url" content="https://itheo.tech/unlocking-pages-with-custom-user-roles-in-wordpress.html"><meta property="og:type" content="article"><link rel="stylesheet" href="https://itheo.tech/assets/css/style.css?v=6fbb1e8931a5afe843374fd67c192c86"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://itheo.tech/unlocking-pages-with-custom-user-roles-in-wordpress.html"},"headline":"Unlocking Pages with Custom User Roles in WordPress","datePublished":"2023-10-31T06:21","dateModified":"2024-06-01T19:42","image":{"@type":"ImageObject","url":"https://itheo.tech/media/posts/103/620d6c13-b129-4771-ae4b-13b646c82058.png","height":1024,"width":1792},"description":"Hello, fellow WordPress enthusiasts! Have you ever wondered how you can take full control over who gets to see what on your WordPress site? Today, I'm going to share the story of how I created a custom WordPress plugin that allows you to do just&hellip;","author":{"@type":"Person","name":"Theo van der Sluijs","url":"https://itheo.tech/authors/theo-van-der-sluijs/"},"publisher":{"@type":"Organization","name":"Theo van der Sluijs","logo":{"@type":"ImageObject","url":"https://itheo.tech/media/website/itheo.tech-500x125-logo.png","height":125,"width":500}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://itheo.tech/"><img src="https://itheo.tech/media/website/itheo.tech-500x125-logo.png" alt="iTheo.Tech" width="500" height="125"></a><div class="search"><div class="search__overlay js-search-overlay"><div class="search__overlay-inner"><button class="search__close js-search-close" aria-label="Close">Close</button></div></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false"><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://itheo.tech/media/posts/103/620d6c13-b129-4771-ae4b-13b646c82058.png" srcset="https://itheo.tech/media/posts/103/responsive/620d6c13-b129-4771-ae4b-13b646c82058-xs.webp 300w, https://itheo.tech/media/posts/103/responsive/620d6c13-b129-4771-ae4b-13b646c82058-sm.webp 480w, https://itheo.tech/media/posts/103/responsive/620d6c13-b129-4771-ae4b-13b646c82058-md.webp 768w, https://itheo.tech/media/posts/103/responsive/620d6c13-b129-4771-ae4b-13b646c82058-lg.webp 1024w, https://itheo.tech/media/posts/103/responsive/620d6c13-b129-4771-ae4b-13b646c82058-xl.webp 1360w, https://itheo.tech/media/posts/103/responsive/620d6c13-b129-4771-ae4b-13b646c82058-2xl.webp 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="1024" width="1792" alt=""></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2023-10-31T06:21">October 31, 2023</time></div><h1>Unlocking Pages with Custom User Roles in WordPress</h1><div class="post__meta post__meta--author"><img src="https://itheo.tech/media/website/64.png" loading="eager" height="512" width="512" class="post__author-thumb" alt="Theo van der Sluijs"> <a href="https://itheo.tech/authors/theo-van-der-sluijs/" class="feed__author">Theo van der Sluijs</a></div></div></header></div><div class="wrapper post__entry"><p>Hello, fellow WordPress enthusiasts! Have you ever wondered how you can take full control over who gets to see what on your WordPress site? Today, I'm going to share the story of how I created a custom WordPress plugin that allows you to do just that. And guess what? You can easily replicate this functionality on your own website!</p><h2 id="heading-the-journey-begins-why-did-i-create-this-code">The Journey Begins: Why Did I Create This Code?</h2><p>Once upon a time, I was managing multiple projects with various team members who had different roles within the organization. We used WordPress as the platform for our internal communication and documentation. However, it quickly became a challenge to manage who had access to what. The default user roles in WordPress—like Editor, Author, and Subscriber—were too broad for our specific use case. I thought, "There's got to be a better way!"</p><p>And so, armed with my development skills and a cup of coffee, I took it upon myself to solve this issue. I decided to create a custom plugin that would allow me to specify which user roles could access specific pages. It was an exhilarating process, full of coding, debugging, and, well, more debugging.</p><h2 id="heading-so-how-does-it-work">So, How Does It Work?</h2><p>Before we dive into the code, let's outline what we want to achieve. We need:</p><ol><li><p>A new meta box in the WordPress Page editor where you can select which user roles have access to the page.</p></li><li><p>A mechanism to check a user's role when they try to access a page and redirect them if they don't have the required role.</p></li></ol><p>Sounds fun, right? Let's get to it!</p><h3 id="heading-step-1-add-a-meta-box-for-role-selection">Step 1: Add a Meta Box for Role Selection</h3><p>Firstly, we use WordPress hooks to add a meta box on the page editor screen. This meta box will contain checkboxes for all the available user roles.</p><pre><code class="lang-php"><span class="hljs-comment">// Add meta box for role selection</span><restore-line-break><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add_role_access_metabox</span>(<span class="hljs-params"></span>) </span>{<restore-line-break>    add_meta_box(<restore-line-break>        <span class="hljs-string">'role_access_metabox'</span>, <span class="hljs-comment">// Meta box ID</span><restore-line-break>        <span class="hljs-string">'Role Access'</span>, <span class="hljs-comment">// Title</span><restore-line-break>        <span class="hljs-string">'role_access_metabox_callback'</span>, <span class="hljs-comment">// Callback function</span><restore-line-break>        <span class="hljs-string">'page'</span>, <span class="hljs-comment">// Post type</span><restore-line-break>        <span class="hljs-string">'side'</span> <span class="hljs-comment">// Context</span><restore-line-break>    );<restore-line-break>}<restore-line-break>add_action(<span class="hljs-string">'add_meta_boxes'</span>, <span class="hljs-string">'add_role_access_metabox'</span>);<restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></code></pre><ul><li><p><strong>Meta box ID:</strong> A unique identifier for the meta box.</p></li><li><p><strong>Title:</strong> The title that appears on the meta box.</p></li><li><p><strong>Callback function:</strong> The function that outputs the content of the meta box.</p></li><li><p><strong>Post type:</strong> Specifies that this meta box is for 'page'.</p></li><li><p><strong>Context:</strong> Specifies that this meta box should appear on the side of the editor.</p></li></ul><h3 id="heading-step-2-define-whats-inside-the-meta-box">Step 2: Define What's Inside the Meta Box</h3><p>The meta box will display checkboxes for each user role. When you select a checkbox, the corresponding role will have access to the page.</p><pre><code class="lang-php"><span class="hljs-comment">// Meta box callback function</span><restore-line-break><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">role_access_metabox_callback</span>(<span class="hljs-params">$post</span>) </span>{<restore-line-break>    <span class="hljs-comment">// ... code ...</span><restore-line-break>    <span class="hljs-keyword">foreach</span> ($all_roles <span class="hljs-keyword">as</span> $role => $details) {<restore-line-break>        <span class="hljs-comment">// ... code ...</span><restore-line-break>    }<restore-line-break>}<restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></code></pre><p>In the above code, <code>$all_roles</code> holds an array of all user roles. We loop through each role to generate a checkbox. Simple yet effective!</p><h3 id="heading-step-3-save-user-roles-as-metadata">Step 3: Save User Roles as Metadata</h3><p>After selecting which roles can access the page, we need to save this information.</p><pre><code class="lang-php"><span class="hljs-comment">// Save post meta data</span><restore-line-break><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">save_role_access</span>(<span class="hljs-params">$post_id</span>) </span>{<restore-line-break>    <span class="hljs-comment">// ... code ...</span><restore-line-break>    update_post_meta($post_id, <span class="hljs-string">'_custom_allowed_roles'</span>, $new_roles);<restore-line-break>}<restore-line-break>add_action(<span class="hljs-string">'save_post'</span>, <span class="hljs-string">'save_role_access'</span>);<restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></code></pre><p>Here, we save the selected roles as metadata for the page.</p><h3 id="heading-step-4-implement-access-control">Step 4: Implement Access Control</h3><p>Lastly, we add a mechanism to check if a user has the required role to view a page.</p><pre><code class="lang-php"><span class="hljs-comment">// Redirect users without access</span><restore-line-break><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check_page_access</span>(<span class="hljs-params"></span>) </span>{<restore-line-break>    <span class="hljs-comment">// ... code ...</span><restore-line-break>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>($allowed)) {<restore-line-break>        wp_redirect(home_url());<restore-line-break>        <span class="hljs-keyword">exit</span>;<restore-line-break>    }<restore-line-break>}<restore-line-break>add_action(<span class="hljs-string">'wp'</span>, <span class="hljs-string">'check_page_access'</span>);<restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></code></pre><p>If a user tries to access a page they don't have permission to view, they are redirected to the home page.</p><p>And there you have it, folks! You can now specify which user roles have access to individual WordPress pages.</p><h2 id="heading-conclusion">Conclusion</h2><p>It's empowering to have complete control over who can access your content. By using this custom plugin, you can fine-tune page visibility to specific user roles, making your WordPress website a more secure and organized space.</p><p>Here's the complete code for your perusal:</p><pre><code class="lang-php"><span class="hljs-meta"><?php</span><restore-line-break><span class="hljs-comment">/**<restore-line-break> * Plugin Name: Custom Role Access<restore-line-break> * Description: Limit page access by user roles.<restore-line-break> * Version: 1.0<restore-line-break> * Author: Theo van der Sluijs<restore-line-break> */</span><restore-line-break><restore-line-break><span class="hljs-comment">// Add meta box for role selection</span><restore-line-break><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add_role_access_metabox</span>(<span class="hljs-params"></span>) </span>{<restore-line-break>    add_meta_box(<restore-line-break>        <span class="hljs-string">'role_access_metabox'</span>,<restore-line-break>        <span class="hljs-string">'Role Access'</span>,<restore-line-break>        <span class="hljs-string">'role_access_metabox_callback'</span>,<restore-line-break>        <span class="hljs-string">'page'</span>,<restore-line-break>        <span class="hljs-string">'side'</span><restore-line-break>    );<restore-line-break>}<restore-line-break>add_action(<span class="hljs-string">'add_meta_boxes'</span>, <span class="hljs-string">'add_role_access_metabox'</span>);<restore-line-break><restore-line-break><span class="hljs-comment">// Meta box callback function</span><restore-line-break><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">role_access_metabox_callback</span>(<span class="hljs-params">$post</span>) </span>{<restore-line-break>    $roles = get_option(<span class="hljs-string">'custom_allowed_roles'</span>);<restore-line-break>    $roles = is_array($roles) ? $roles : [];<restore-line-break><restore-line-break>    $all_roles = get_editable_roles();<restore-line-break>    $selected_roles = get_post_meta($post->ID, <span class="hljs-string">'_custom_allowed_roles'</span>, <span class="hljs-literal">true</span>);<restore-line-break>    $selected_roles = is_array($selected_roles) ? $selected_roles : [];<restore-line-break><restore-line-break>    wp_nonce_field(<span class="hljs-string">'role_access_metabox'</span>, <span class="hljs-string">'role_access_metabox_nonce'</span>);<restore-line-break>    <span class="hljs-keyword">foreach</span> ($all_roles <span class="hljs-keyword">as</span> $role => $details) {<restore-line-break>        $name = translate_user_role($details[<span class="hljs-string">'name'</span>]);<restore-line-break>        <span class="hljs-keyword">echo</span> <span class="hljs-string">'<input type="checkbox" name="custom_allowed_roles[]" value="'</span> . esc_attr($role) . <span class="hljs-string">'"'</span>;<restore-line-break>        <span class="hljs-keyword">if</span> (in_array($role, $selected_roles)) {<restore-line-break>            <span class="hljs-keyword">echo</span> <span class="hljs-string">' checked="checked"'</span>;<restore-line-break>        }<restore-line-break>        <span class="hljs-keyword">echo</span> <span class="hljs-string">'> '</span> . esc_html($name) . <span class="hljs-string">'<br>'</span>;<restore-line-break>    }<restore-line-break>}<restore-line-break><restore-line-break><span class="hljs-comment">// Save post meta data</span><restore-line-break><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">save_role_access</span>(<span class="hljs-params">$post_id</span>) </span>{<restore-line-break>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">'role_access_metabox_nonce'</span>]) || !wp_verify_nonce($_POST[<span class="hljs-string">'role_access_metabox_nonce'</span>], <span class="hljs-string">'role_access_metabox'</span>)) {<restore-line-break>        <span class="hljs-keyword">return</span>;<restore-line-break>    }<restore-line-break>    <span class="hljs-keyword">if</span> (defined(<span class="hljs-string">'DOING_AUTOSAVE'</span>) && DOING_AUTOSAVE) {<restore-line-break>        <span class="hljs-keyword">return</span>;<restore-line-break>    }<restore-line-break>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">'post_type'</span>]) && <span class="hljs-string">'page'</span> == $_POST[<span class="hljs-string">'post_type'</span>]) {<restore-line-break>        <span class="hljs-keyword">if</span> (!current_user_can(<span class="hljs-string">'edit_page'</span>, $post_id)) {<restore-line-break>            <span class="hljs-keyword">return</span>;<restore-line-break>        }<restore-line-break>    }<restore-line-break>    $new_roles = <span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">'custom_allowed_roles'</span>]) ? $_POST[<span class="hljs-string">'custom_allowed_roles'</span>] : [];<restore-line-break>    update_post_meta($post_id, <span class="hljs-string">'_custom_allowed_roles'</span>, $new_roles);<restore-line-break>}<restore-line-break>add_action(<span class="hljs-string">'save_post'</span>, <span class="hljs-string">'save_role_access'</span>);<restore-line-break><restore-line-break><span class="hljs-comment">// Redirect users without access</span><restore-line-break><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check_page_access</span>(<span class="hljs-params"></span>) </span>{<restore-line-break>    <span class="hljs-keyword">if</span> (is_page() && !is_user_logged_in()) {<restore-line-break>        <span class="hljs-keyword">global</span> $post;<restore-line-break>        $selected_roles = get_post_meta($post->ID, <span class="hljs-string">'_custom_allowed_roles'</span>, <span class="hljs-literal">true</span>);<restore-line-break>        <span class="hljs-keyword">if</span> (is_array($selected_roles) && !<span class="hljs-keyword">empty</span>($selected_roles)) {<restore-line-break>            wp_redirect(home_url());<restore-line-break>            <span class="hljs-keyword">exit</span>;<restore-line-break>        }<restore-line-break>    }<restore-line-break>    <span class="hljs-keyword">if</span> (is_page() && is_user_logged_in()) {<restore-line-break>        <span class="hljs-keyword">global</span> $post, $current_user;<restore-line-break>        $selected_roles = get_post_meta($post->ID, <span class="hljs-string">'_custom_allowed_roles'</span>, <span class="hljs-literal">true</span>);<restore-line-break>        <span class="hljs-keyword">if</span> (is_array($selected_roles) && !<span class="hljs-keyword">empty</span>($selected_roles)) {<restore-line-break>            $user_roles = $current_user->roles;<restore-line-break>            $allowed = array_intersect($selected_roles, $user_roles);<restore-line-break>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>($allowed)) {<restore-line-break>                wp_redirect(home_url());<restore-line-break>                <span class="hljs-keyword">exit</span>;<restore-line-break>            }<restore-line-break>        }<restore-line-break>    }<restore-line-break>}<restore-line-break>add_action(<span class="hljs-string">'wp'</span>, <span class="hljs-string">'check_page_access'</span>);<restore-line-break><span class="hljs-meta">?></span><restore-line-break></restore-line-break></code></pre><p>I hope you found this tutorial exciting and useful. Do you have any questions or something to add? Feel free to comment below! Until next time, happy coding!</p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on June 1, 2024</p><div class="post__share"></div><div class="post__bio bio"><img src="https://itheo.tech/media/website/64.png" loading="lazy" height="512" width="512" class="bio__avatar" alt="Theo van der Sluijs"><div><h3 class="bio__name"><a href="https://itheo.tech/authors/theo-van-der-sluijs/" rel="author">Theo van der Sluijs</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://itheo.tech/crafting-a-custom-wordpress-login-page-with-shortcodes.html" class="post__nav-link" rel="prev"><span>Previous</span> Crafting a Custom WordPress Login Page With Shortcodes</a></div><div class="post__nav-next"><a href="https://itheo.tech/integrating-your-volvo-v60-into-your-smart-home.html" class="post__nav-link" rel="next"><span>Next</span> Integrating Your Volvo V60 into Your Smart Home </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav><div class="post__related related"><div class="wrapper"><h2 class="h5 related__title">You should also read:</h2><article class="related__item"><div class="feed__meta"><time datetime="2015-03-20T19:17" class="feed__date">March 20, 2015</time></div><h3 class="h1"><a href="https://itheo.tech/user-ip-validation-ip-add-by-email-script-php-mongodb.html">User ip validation, ip add by email script php mongodb</a></h3></article><article class="related__item"><div class="feed__meta"><time datetime="2015-08-11T11:52" class="feed__date">August 11, 2015</time></div><h3 class="h1"><a href="https://itheo.tech/better-mongodb-backup-script-with-tar-and-move-to-s3-bucket.html">Better MongoDB backup script with Tar and move to S3 Bucket</a></h3></article><article class="related__item"><div class="feed__meta"><time datetime="2018-03-18T12:35" class="feed__date">March 18, 2018</time></div><h3 class="h1"><a href="https://itheo.tech/using-ubuntu-on-windows-10-without-admin-rights.html">Using Ubuntu on Windows 10 without Admin Rights</a></h3></article></div></div></main><footer class="footer"><div class="footer__copyright"><p>iTheo.Tech</p></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script defer="defer" src="https://itheo.tech/assets/js/scripts.min.js?v=f47c11534595205f20935f0db2a62a85"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>