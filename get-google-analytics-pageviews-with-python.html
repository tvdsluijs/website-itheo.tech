<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Get Google Analytics pageviews with python - iTheo.Tech</title><meta name="description" content="Live pageviews on a Jekyll page with google analytics and python flask is possible with this easy to follow step by step guide and example python script. So I was thinking, how to get live pageviews to show on my Jekyll site. A Jekyll site&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://itheo.tech/get-google-analytics-pageviews-with-python.html"><link rel="alternate" type="application/atom+xml" href="https://itheo.tech/feed.xml"><link rel="alternate" type="application/json" href="https://itheo.tech/feed.json"><meta property="og:title" content="Get Google Analytics pageviews with python"><meta property="og:image" content="https://itheo.tech/media/posts/38/yrC6XPthZ.jpeg"><meta property="og:image:width" content="1600"><meta property="og:image:height" content="976"><meta property="og:site_name" content="iTheo.Tech"><meta property="og:description" content="Live pageviews on a Jekyll page with google analytics and python flask is possible with this easy to follow step by step guide and example python script. So I was thinking, how to get live pageviews to show on my Jekyll site. A Jekyll site&hellip;"><meta property="og:url" content="https://itheo.tech/get-google-analytics-pageviews-with-python.html"><meta property="og:type" content="article"><link rel="stylesheet" href="https://itheo.tech/assets/css/style.css?v=6fbb1e8931a5afe843374fd67c192c86"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://itheo.tech/get-google-analytics-pageviews-with-python.html"},"headline":"Get Google Analytics pageviews with python","datePublished":"2019-01-05T23:00","dateModified":"2024-06-01T19:42","image":{"@type":"ImageObject","url":"https://itheo.tech/media/posts/38/yrC6XPthZ.jpeg","height":976,"width":1600},"description":"Live pageviews on a Jekyll page with google analytics and python flask is possible with this easy to follow step by step guide and example python script. So I was thinking, how to get live pageviews to show on my Jekyll site. A Jekyll site&hellip;","author":{"@type":"Person","name":"Theo van der Sluijs","url":"https://itheo.tech/authors/theo-van-der-sluijs/"},"publisher":{"@type":"Organization","name":"Theo van der Sluijs","logo":{"@type":"ImageObject","url":"https://itheo.tech/media/website/itheo.tech-500x125-logo.png","height":125,"width":500}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://itheo.tech/"><img src="https://itheo.tech/media/website/itheo.tech-500x125-logo.png" alt="iTheo.Tech" width="500" height="125"></a><div class="search"><div class="search__overlay js-search-overlay"><div class="search__overlay-inner"><button class="search__close js-search-close" aria-label="Close">Close</button></div></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false"><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://itheo.tech/media/posts/38/yrC6XPthZ.jpeg" srcset="https://itheo.tech/media/posts/38/responsive/yrC6XPthZ-xs.webp 300w, https://itheo.tech/media/posts/38/responsive/yrC6XPthZ-sm.webp 480w, https://itheo.tech/media/posts/38/responsive/yrC6XPthZ-md.webp 768w, https://itheo.tech/media/posts/38/responsive/yrC6XPthZ-lg.webp 1024w, https://itheo.tech/media/posts/38/responsive/yrC6XPthZ-xl.webp 1360w, https://itheo.tech/media/posts/38/responsive/yrC6XPthZ-2xl.webp 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="976" width="1600" alt=""></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2019-01-05T23:00">January 5, 2019</time></div><h1>Get Google Analytics pageviews with python</h1><div class="post__meta post__meta--author"><img src="https://itheo.tech/media/website/64.png" loading="eager" height="512" width="512" class="post__author-thumb" alt="Theo van der Sluijs"> <a href="https://itheo.tech/authors/theo-van-der-sluijs/" class="feed__author">Theo van der Sluijs</a></div></div></header></div><div class="wrapper post__entry"><p>Live pageviews on a Jekyll page with google analytics and python flask is possible with this easy to follow step by step guide and example python script.</p><p>So I was thinking, how to get live pageviews to show on my Jekyll site. A Jekyll site is a static site, it’s generated for display as static HTML pages. It’s not generated at every view but only once when it’s uploaded to de server. And when it is re-uploaded. So you can’t really show “live” pages views…. or can you?</p><p>So I actually came up with a very simple solution to show page views on my site. I would create a small javascript that would call a api. That api would then write a view in to a database and get the number of views of that page.</p><p>I would need:</p><ul><li>1 small piece of javascript</li><li>1 SQLite database</li><li>1 small API script</li></ul><p>The API script is creating or updating a row in the database and getting the new number of views.</p><p>When I was writing the code, I started thinking of how I would handle reloads of a page. I don’t want every reload of a page to count as an actual view. If I would press F5 I would create hundreds of false views in a second.</p><p>So I started creating some cookie scripts and changed the API to create unique views.</p><p>And it got bigger and bigger….because I wanted it to be save and GDPR proof…. and then I was like …. okay, this will never go live, it’s becoming to complicated. And then I had a revelation! Google Analytics! They already have unique page views. They have everything in place for GDPR and reload counts.</p><p>And there is a Google Analytic API where you can actually get data every easy.</p><p>I did keep the SQLite database in between, I dont want to flood the google api with every view / call I have on my pages. Not that I have like a million pageviews per day, but I want to play it nice. And it’s really not important if you can see page views that is 4 tot 8 hours old or realtime.</p><h2 id="heading-google-analytics-api">Google Analytics API</h2><p>So there are a view things you need for this to work. Getting Google analytics pageViews or Page Views is not difficult but you need to do the following.</p><p>To get started using Analytics Reporting API v4, you need to first <a target="_blank" href="https://console.developers.google.com/start/api?id=analyticsreporting.googleapis.com&credential=client_key" rel="noopener">use the setup tool</a>, which guides you through creating a project in the Google API Console, enabling the API, and creating credentials.</p><h4 id="heading-create-credentials">Create credentials</h4><p><strong>Note:</strong> When prompted click <strong>Furnish a new private key</strong> and for the <em>Key type</em> select <strong>JSON</strong>, and save the generated key as <code>client_secrets.json</code>; you will need it later in this tutorial.</p><ol><li>Open the <a target="_blank" href="https://console.developers.google.com/iam-admin/serviceaccounts" rel="noopener"><strong>Service accounts</strong> page</a>. If prompted, select a project.</li><li>Click <strong>Create service account</strong>.</li><li>In the <strong>Create service account</strong> window, type a name for the service account, and select <strong>Furnish a new private key</strong>. Then click <strong>Save</strong>.</li></ol><p>Your new public/private key pair is generated and downloaded to your machine; it serves as the only copy of this key. You are responsible for storing it securely.</p><h4 id="heading-add-service-account-to-the-google-analytics-account">Add service account to the Google Analytics account</h4><p>The newly created service account will have an email address that looks similar to:</p><p><code>quickstart@PROJECT-ID.iam.gserviceaccount.com</code></p><p>Use this email address to <a target="_blank" href="https://support.google.com/analytics/answer/1009702" rel="noopener">add a user</a> to the Google analytics view you want to access via the API.</p><p>In this case only <a target="_blank" href="https://support.google.com/analytics/answer/2884495" rel="noopener">Read & Analyze</a> permissions are needed.</p><h3 id="heading-install-the-client-library">Install the client library</h3><p>You can either use a package manager or download and install the Python client library manually:</p><p>But installing is most easy by:</p><p>$ pip install google-api-python-client</p><p>and</p><p>$ pip install oauth2client</p><p>for more information about using and installing the google-api-python-client go to <a target="_blank" href="https://developers.google.com/analytics/devguides/reporting/core/v4/quickstart/service-py" rel="noopener">this page</a>.</p><h3 id="heading-getting-things-ready">Getting things ready</h3><p>You need to follow the following steps to get things wrapped up to make use of the Google Analytics API together with Python</p><ol><li>Move the previously downloaded <code>client_secrets.json</code> to the same directory as the sample code.</li><li>Replace the value of <code>VIEW_ID</code>. You can use the <a target="_blank" href="https://ga-dev-tools.appspot.com/account-explorer/" rel="noopener">Account Explorer</a> to find a View ID.</li><li>create a google_analytics.py file to put in the python code.</li></ol><h2 id="heading-python-code">Python code</h2><p>Now for this example I’m gonna leave out the SQLite example, but as a bonus I’ve put my code ready for you in my <a target="_blank" href="https://github.com/tvdsluijs/pageview_analytics_sqlite_python" rel="noopener">GitHub account</a>.</p><p>So way below you will only find de code to show it in a page, and getting the information with python.</p><p>The most difficult for me was to find out how the Google Analytics v4 API worked, well more how to get the right data out of the API</p><p>body = { 'reportRequests': [ { 'viewId': self.view_id, 'dateRanges': [{'startDate': self.startdate, 'endDate': self.enddata}], 'metrics': [{'expression': 'ga:uniquePageviews'}, {'expression': 'ga:pageviews'}], 'filtersExpression': pagePath }] }</p><p>So you need the view_id from your site from the google analytics account. You also need a start and end date written like “Y-M-D” Year, Month and day.</p><p>Then you have to tell what metrics you would like to get back from the Google Analytics API.</p><p>So I’ve chosen to use the uniquePageviews and the pageviews.</p><p>A <strong>unique pageview</strong>, as seen in the Content Overview report, aggregates<strong>pageviews</strong> that are generated by the same user during the same session. A <strong>unique pageview</strong> represents the number of sessions during which that page was viewed one or more times.</p><p>A <strong>pageview</strong> (or <strong>pageview</strong> hit, page tracking hit) is an instance of a page being loaded (or reloaded) in a browser. <strong>Pageviews</strong> is a metric defined as the total number of pages viewed. So, the total number of visits per page.</p><p>And then at the end you have to tell the API for what page you want to see the data. So you have to filter the expression on PagePath.</p><h2 id="heading-jquery-google-python-analytics-code-and-jekyll">JQuery Google Python Analytics code and Jekyll</h2><p>So I don’t want to get the page views on the home page, so I’ve made sure that the call is only fired when a user visits an article page and created a script within my jekyll theme.</p><p>Within the Page I created a span <code><span id="urlviews"></span></code> where the information should show and! the script checks if the div or span with a certain id exists and then fires the call to my api python page to get the information.</p><pre><code>$(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{  <restore-line-break>    <span class="hljs-keyword">var</span> $urlviews <span class="hljs-operator">=</span> $(<span class="hljs-string">'#urlviews'</span>);  <restore-line-break><span class="hljs-comment">// check if urlviews exsists  </span><restore-line-break>    <span class="hljs-keyword">if</span> ( $urlviews.<span class="hljs-built_in">length</span> ){  <restore-line-break>        $.getJSON( <span class="hljs-string">"{{site.api_url}}/url_views?path={{site.view_id}}:{{page.url}}"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> json </span>) </span>{  <restore-line-break>            $(<span class="hljs-string">"#urlviews"</span>).html(json.views+<span class="hljs-string">" Views."</span>);  <restore-line-break>        });  <restore-line-break>    }  <restore-line-break>});  <restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></code></pre><p>So the <code>if ( $urlviews.length ){</code> part checks together with <code>var $urlviews = $('#urlviews');</code> if the urlviews id actually exists. If it exists (lenght is not None) it starts the rest of the code</p><p>$.getJSON( "{{site.api_url}}/url_views?path={{site.view_id}}:{{page.url}}", function( json ) {</p><p>is go call a url together with the view_id and the page url.</p><p>Now I have to tell you that I made this for Jekyll so if you thing what are those <code>{{ }}</code> well it’s a certain way to tell Jekyll what to place in it. As I already told you Jekyll is a static page generator and uses the liquid template engine.</p><p>So:</p><p>{{site.api_url}}</p><p>displays the api URL defined within the _config</p><p>{{site.view_id}}</p><p>shows a view_id I defined within the _config</p><p>{{page.url}}</p><p>shows the page url (without the domain)</p><p>As you can see I have a separator between the view_id and the page url. Within my API a split this var and use both variables separately to get the information from Google analytics, or in my case from my database or google analytics.</p><h2 id="heading-python-flask">Python Flask</h2><p>Now, If you really want to make this script into a API you need a framework to behave like a web based api that give you back some information. You can to this with Flask. I’m not gonna explain how I managed to do that in this article as this article is already long enough.<img loading="lazy" src="https://itheo.tech/media/posts/38/gLsk8A6L2.json" alt="Ghostboard pixel"></p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on June 1, 2024</p><div class="post__share"></div><div class="post__bio bio"><img src="https://itheo.tech/media/website/64.png" loading="lazy" height="512" width="512" class="bio__avatar" alt="Theo van der Sluijs"><div><h3 class="bio__name"><a href="https://itheo.tech/authors/theo-van-der-sluijs/" rel="author">Theo van der Sluijs</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://itheo.tech/send-files-with-gmail-using-a-python-script.html" class="post__nav-link" rel="prev"><span>Previous</span> Send files with Gmail using a python script</a></div><div class="post__nav-next"><a href="https://itheo.tech/repair-and-compress-pdf-files-with-python.html" class="post__nav-link" rel="next"><span>Next</span> Repair and compress PDF files with python </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav><div class="post__related related"><div class="wrapper"><h2 class="h5 related__title">You should also read:</h2><article class="related__item"><div class="feed__meta"><time datetime="2018-10-03T22:00" class="feed__date">October 3, 2018</time></div><h3 class="h1"><a href="https://itheo.tech/scraping-contact-data-with-python-export-to-csv.html">Scraping contact data with Python export to csv</a></h3></article><article class="related__item"><div class="feed__meta"><time datetime="2018-11-30T23:00" class="feed__date">November 30, 2018</time></div><h3 class="h1"><a href="https://itheo.tech/image-resize-python-automation-script.html">Image resize python automation script</a></h3></article><article class="related__item"><div class="feed__meta"><time datetime="2018-12-19T23:00" class="feed__date">December 19, 2018</time></div><h3 class="h1"><a href="https://itheo.tech/get-colors-from-images-python-script.html">Get colors from images python script</a></h3></article></div></div></main><footer class="footer"><div class="footer__copyright"><p>iTheo.Tech</p></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script defer="defer" src="https://itheo.tech/assets/js/scripts.min.js?v=f47c11534595205f20935f0db2a62a85"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>