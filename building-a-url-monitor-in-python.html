<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Building a URL Monitor in Python - iTheo.Tech</title><meta name="description" content="Monitoring website availability and response time is crucial for businesses and developers. In this post, we'll create a Python application that reads URLs from a text file, makes HTTP requests to each URL, and logs the HTTP status code, load time, and timestamp in an&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://itheo.tech/building-a-url-monitor-in-python.html"><link rel="alternate" type="application/atom+xml" href="https://itheo.tech/feed.xml"><link rel="alternate" type="application/json" href="https://itheo.tech/feed.json"><meta property="og:title" content="Building a URL Monitor in Python"><meta property="og:image" content="https://itheo.tech/media/posts/94/1d7d760a5e51fa438b100ff54158efeb.jpeg"><meta property="og:image:width" content="1600"><meta property="og:image:height" content="1067"><meta property="og:site_name" content="iTheo.Tech"><meta property="og:description" content="Monitoring website availability and response time is crucial for businesses and developers. In this post, we'll create a Python application that reads URLs from a text file, makes HTTP requests to each URL, and logs the HTTP status code, load time, and timestamp in an&hellip;"><meta property="og:url" content="https://itheo.tech/building-a-url-monitor-in-python.html"><meta property="og:type" content="article"><link rel="stylesheet" href="https://itheo.tech/assets/css/style.css?v=6fbb1e8931a5afe843374fd67c192c86"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://itheo.tech/building-a-url-monitor-in-python.html"},"headline":"Building a URL Monitor in Python","datePublished":"2023-05-16T08:52","dateModified":"2024-06-01T19:42","image":{"@type":"ImageObject","url":"https://itheo.tech/media/posts/94/1d7d760a5e51fa438b100ff54158efeb.jpeg","height":1067,"width":1600},"description":"Monitoring website availability and response time is crucial for businesses and developers. In this post, we'll create a Python application that reads URLs from a text file, makes HTTP requests to each URL, and logs the HTTP status code, load time, and timestamp in an&hellip;","author":{"@type":"Person","name":"Theo van der Sluijs","url":"https://itheo.tech/authors/theo-van-der-sluijs/"},"publisher":{"@type":"Organization","name":"Theo van der Sluijs","logo":{"@type":"ImageObject","url":"https://itheo.tech/media/website/itheo.tech-500x125-logo.png","height":125,"width":500}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://itheo.tech/"><img src="https://itheo.tech/media/website/itheo.tech-500x125-logo.png" alt="iTheo.Tech" width="500" height="125"></a><div class="search"><div class="search__overlay js-search-overlay"><div class="search__overlay-inner"><button class="search__close js-search-close" aria-label="Close">Close</button></div></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false"><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://itheo.tech/media/posts/94/1d7d760a5e51fa438b100ff54158efeb.jpeg" srcset="https://itheo.tech/media/posts/94/responsive/1d7d760a5e51fa438b100ff54158efeb-xs.webp 300w, https://itheo.tech/media/posts/94/responsive/1d7d760a5e51fa438b100ff54158efeb-sm.webp 480w, https://itheo.tech/media/posts/94/responsive/1d7d760a5e51fa438b100ff54158efeb-md.webp 768w, https://itheo.tech/media/posts/94/responsive/1d7d760a5e51fa438b100ff54158efeb-lg.webp 1024w, https://itheo.tech/media/posts/94/responsive/1d7d760a5e51fa438b100ff54158efeb-xl.webp 1360w, https://itheo.tech/media/posts/94/responsive/1d7d760a5e51fa438b100ff54158efeb-2xl.webp 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="1067" width="1600" alt=""></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2023-05-16T08:52">May 16, 2023</time></div><h1>Building a URL Monitor in Python</h1><div class="post__meta post__meta--author"><img src="https://itheo.tech/media/website/64.png" loading="eager" height="512" width="512" class="post__author-thumb" alt="Theo van der Sluijs"> <a href="https://itheo.tech/authors/theo-van-der-sluijs/" class="feed__author">Theo van der Sluijs</a></div></div></header></div><div class="wrapper post__entry"><p>Monitoring website availability and response time is crucial for businesses and developers. In this post, we'll create a Python application that reads URLs from a text file, makes HTTP requests to each URL, and logs the HTTP status code, load time, and timestamp in an Excel file. To make our application efficient, we'll use multithreading to check multiple URLs simultaneously. We'll use Poetry for dependency management and unittest for testing.</p><h2 id="heading-project-setup-with-poetry">Project Setup with Poetry</h2><p>We'll begin by setting up our Python project with Poetry. Poetry is a tool for dependency management and packaging in Python, allowing you to declare libraries your project depends on and it will manage (install/update) them for you. It simplifies package management and deployment of Python applications.</p><ol><li>Install Poetry if you haven't done so:</li></ol><pre><code class="lang-python">shCopy codecurl -sSL https://install.python-poetry.org | python3 -<restore-line-break></restore-line-break></code></pre><ol><li>Create a new Python project:</li></ol><pre><code class="lang-python">shCopy codepoetry new url_checker cd url_checker<restore-line-break></restore-line-break></code></pre><ol><li>Add the necessary dependencies:</li></ol><pre><code class="lang-python">shCopy codepoetry add requests pandas openpyxl<restore-line-break></restore-line-break></code></pre><h2 id="heading-the-python-script">The Python Script</h2><p>Create a new Python script, say <code>url_checker.py</code>, in the project's root directory with the following code:</p><pre><code class="lang-python"><span class="hljs-keyword">import</span> datetime<restore-line-break><span class="hljs-keyword">import</span> time<restore-line-break><span class="hljs-keyword">import</span> requests<restore-line-break><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<restore-line-break><span class="hljs-keyword">import</span> os<restore-line-break><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor<restore-line-break><restore-line-break><span class="hljs-comment"># number of threads to use</span><restore-line-break>NUM_WORKERS = <span class="hljs-number">10</span><restore-line-break><restore-line-break><span class="hljs-comment"># delay in minutes</span><restore-line-break>DELAY = <span class="hljs-number">5</span>  <span class="hljs-comment"># adjust this value to your needs</span><restore-line-break><restore-line-break><span class="hljs-comment"># filename that contains the URLs</span><restore-line-break>URL_FILE = <span class="hljs-string">"urls.txt"</span><restore-line-break><restore-line-break><span class="hljs-comment"># output file name</span><restore-line-break>OUTPUT_FILE = <span class="hljs-string">"output.xlsx"</span><restore-line-break><restore-line-break><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">check_url</span>(<span class="hljs-params">url</span>):</span><restore-line-break>    start_time = time.time()<restore-line-break>    <span class="hljs-keyword">try</span>:<restore-line-break>        response = requests.get(url)<restore-line-break>        end_time = time.time()<restore-line-break>        load_time = end_time - start_time<restore-line-break>        status_code = response.status_code<restore-line-break>    <span class="hljs-keyword">except</span> Exception:<restore-line-break>        status_code = <span class="hljs-string">"Invalid URL"</span><restore-line-break>        load_time = <span class="hljs-string">"N/A"</span><restore-line-break>    timestamp = datetime.datetime.now()<restore-line-break>    <span class="hljs-keyword">return</span> url, status_code, load_time, timestamp<restore-line-break><restore-line-break><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><restore-line-break>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<restore-line-break>        print(<span class="hljs-string">"Working on URLs..."</span>)<restore-line-break>        <span class="hljs-keyword">with</span> open(URL_FILE, <span class="hljs-string">"r"</span>) <span class="hljs-keyword">as</span> file:<restore-line-break>            urls = [line.strip() <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> file]<restore-line-break><restore-line-break>        <span class="hljs-keyword">with</span> ThreadPoolExecutor(max_workers=NUM_WORKERS) <span class="hljs-keyword">as</span> executor:<restore-line-break>            results = list(executor.map(check_url, urls))<restore-line-break><restore-line-break>        new_df = pd.DataFrame(results, columns=[<span class="hljs-string">'URL'</span>, <span class="hljs-string">'Status Code'</span>, <span class="hljs-string">'Load Time'</span>, <span class="hljs-string">'Timestamp'</span>])<restore-line-break><restore-line-break>        <span class="hljs-comment"># if file does not exist write header </span><restore-line-break>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.isfile(OUTPUT_FILE):<restore-line-break>            new_df.to_excel(OUTPUT_FILE, index=<span class="hljs-literal">False</span>)<restore-line-break>        <span class="hljs-keyword">else</span>: <span class="hljs-comment"># else it exists so append without writing the header</span><restore-line-break>            df = pd.read_excel(OUTPUT_FILE)<restore-line-break>            df = pd.concat([df, new_df])<restore-line-break>            df.to_excel(OUTPUT_FILE, index=<span class="hljs-literal">False</span>)<restore-line-break><restore-line-break>        print(<span class="hljs-string">f"Finished checking URLs. Sleeping for <span class="hljs-subst">{DELAY}</span> minutes."</span>)<restore-line-break>        time.sleep(DELAY * <span class="hljs-number">60</span>)<restore-line-break><restore-line-break><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:<restore-line-break>    main()<restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></code></pre><p>Our Python script consists of two main functions: <code>check_url</code> and <code>main</code>.</p><p>The <code>check_url</code> function is responsible for making an HTTP request to a given URL and measuring the response time. It records the HTTP status code, load time, and the current timestamp. If the URL is invalid or not reachable, it will record "Invalid URL" as the status code and "N/A" as the load time.</p><p>The <code>main</code> function is the driver function that reads URLs from a text file, uses a thread pool to check URLs concurrently, and logs the results in an Excel file. It runs in an infinite loop, sleeping for a specified number of minutes between each round of URL checks. It prints to the terminal whether it's currently working on URLs or sleeping.</p><h2 id="heading-multithreading-with-threadpoolexecutor">Multithreading with ThreadPoolExecutor</h2><p>The <code>ThreadPoolExecutor</code> class from the <code>concurrent.futures</code> module allows us to create a pool of worker threads. Each thread can check a URL independently of the others, which means we can check multiple URLs simultaneously. This is a significant speed-up if we have many URLs to check.</p><h2 id="heading-logging-results-in-excel">Logging Results in Excel</h2><p>We use the <code>pandas</code> library to log results in an Excel file. Each time the script checks URLs, it appends the results to the Excel file rather than overwriting it. It does this by reading in the existing data, concatenating the new data, and then writing it out again.</p><p>You can run the script with:</p><pre><code class="lang-python">shCopy codepoetry run python url_checker.py<restore-line-break></restore-line-break></code></pre><h2 id="heading-testing-with-unittest">Testing with unittest</h2><p>Python's built-in <code>unittest</code> module allows us to write unit tests for our code. For our script, we could write tests to ensure that our <code>check_url</code> function returns the correct output given a specific input. We could also write tests to ensure that our script correctly reads URLs from a file, logs results in an Excel file, and sleeps for the correct amount of time.</p><p>In our use case, writing unit tests would be a bit tricky due to the nature of the operations we are performing (network requests, file operations, and sleeping). However, we can still write some basic tests to verify our <code>check_url</code> function.</p><p>Let's create a new file named <code>test_url_checker.py</code> in the project's root directory:</p><pre><code class="lang-python"><span class="hljs-keyword">import</span> unittest<restore-line-break><span class="hljs-keyword">from</span> url_checker <span class="hljs-keyword">import</span> check_url<restore-line-break><restore-line-break><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestURLChecker</span>(<span class="hljs-params">unittest.TestCase</span>):</span><restore-line-break>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_check_url</span>(<span class="hljs-params">self</span>):</span><restore-line-break>        <span class="hljs-comment"># Testing with a valid URL</span><restore-line-break>        url, status_code, load_time, _ = check_url(<span class="hljs-string">'https://www.google.com'</span>)<restore-line-break>        self.assertEqual(url, <span class="hljs-string">'https://www.google.com'</span>)<restore-line-break>        self.assertEqual(status_code, <span class="hljs-number">200</span>)<restore-line-break>        self.assertNotEqual(load_time, <span class="hljs-string">'N/A'</span>)<restore-line-break><restore-line-break>        <span class="hljs-comment"># Testing with an invalid URL</span><restore-line-break>        url, status_code, load_time, _ = check_url(<span class="hljs-string">'https://www.nonexistentwebsite123456.com'</span>)<restore-line-break>        self.assertEqual(url, <span class="hljs-string">'https://www.nonexistentwebsite123456.com'</span>)<restore-line-break>        self.assertEqual(status_code, <span class="hljs-string">'Invalid URL'</span>)<restore-line-break>        self.assertEqual(load_time, <span class="hljs-string">'N/A'</span>)<restore-line-break><restore-line-break><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<restore-line-break>    unittest.main()<restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></restore-line-break></code></pre><p>This script tests the <code>check_url</code> function with both a valid URL and an invalid URL. For the valid URL, we expect the status code to be 200 and the load time to not be 'N/A'. For the invalid URL, we expect the status code to be 'Invalid URL' and the load time to be 'N/A'.</p><p>You can run the tests with:</p><pre><code class="lang-sh">poetry run python test_url_checker.py<restore-line-break></restore-line-break></code></pre><p>Remember to replace <code>'</code><a target="_blank" href="https://www.google.com" rel="noopener"><code>https://www.google.com</code></a><code>'</code> and <code>'</code><a target="_blank" href="https://www.nonexistentwebsite123456.com" rel="noopener"><code>https://www.nonexistentwebsite123456.com</code></a><code>'</code> with URLs of your choice.</p><p><em>Note: Testing with network requests can be unpredictable as the status code may vary based on network conditions, server availability, etc. For more reliable tests, you might want to consider using a library like</em> <code>responses</code> to mock HTTP requests.</p><hr><p>In conclusion, the combination of Python with multithreading, Poetry, and unittest provides a powerful toolkit for building a URL monitor. This application is a robust, efficient solution for checking the availability and response time of a list of websites and logging the results for analysis. Happy coding!</p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on June 1, 2024</p><div class="post__share"></div><div class="post__bio bio"><img src="https://itheo.tech/media/website/64.png" loading="lazy" height="512" width="512" class="bio__avatar" alt="Theo van der Sluijs"><div><h3 class="bio__name"><a href="https://itheo.tech/authors/theo-van-der-sluijs/" rel="author">Theo van der Sluijs</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://itheo.tech/generate-ubl-invoices-in-python-using-poetry-and-lxml.html" class="post__nav-link" rel="prev"><span>Previous</span> Generate UBL Invoices in Python using Poetry and lxml</a></div><div class="post__nav-next"><a href="https://itheo.tech/harnessing-openais-gpt-4-api-with-python-poetry-and-unittest.html" class="post__nav-link" rel="next"><span>Next</span> Harnessing OpenAI&#x27;s GPT-4 API with Python, Poetry and Unittest </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav><div class="post__related related"><div class="wrapper"><h2 class="h5 related__title">You should also read:</h2><article class="related__item"><div class="feed__meta"><time datetime="2018-10-03T22:00" class="feed__date">October 3, 2018</time></div><h3 class="h1"><a href="https://itheo.tech/scraping-contact-data-with-python-export-to-csv.html">Scraping contact data with Python export to csv</a></h3></article><article class="related__item"><div class="feed__meta"><time datetime="2018-11-30T23:00" class="feed__date">November 30, 2018</time></div><h3 class="h1"><a href="https://itheo.tech/image-resize-python-automation-script.html">Image resize python automation script</a></h3></article><article class="related__item"><div class="feed__meta"><time datetime="2018-12-19T23:00" class="feed__date">December 19, 2018</time></div><h3 class="h1"><a href="https://itheo.tech/get-colors-from-images-python-script.html">Get colors from images python script</a></h3></article></div></div></main><footer class="footer"><div class="footer__copyright"><p>iTheo.Tech</p></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://itheo.tech/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script defer="defer" src="https://itheo.tech/assets/js/scripts.min.js?v=f47c11534595205f20935f0db2a62a85"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>